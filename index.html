<!--https://demos.telerik.com/kendo-ui/content/shared/js/mobile-examples.js-->
<!--?displayName=小華&userId=U722be0c9c9d36e011c0e556bd2047819&pictureUrl=www.google.com-->
    
<!DOCTYPE html>
<html>

<head>
  <title></title>
  <meta name="msapplication-tap-highlight" content="no" />

  <!--  using Noto Sans TC is added by Paul Kang-->
  <link href="https://fonts.googleapis.com/css?family=Noto+Sans+TC&display=swap" rel="stylesheet">

  <link href="https://kendo.cdn.telerik.com/2020.1.114/styles/kendo.common-nova.min.css" rel="stylesheet" />
  <link href="https://kendo.cdn.telerik.com/2020.1.114/styles/kendo.nova.min.css" rel="stylesheet" />
  <link href="https://kendo.cdn.telerik.com/2020.1.114/styles/kendo.mobile.nova.min.css" rel="stylesheet" />   

<!--  <link href="/kendo-ui/content/shared/styles/console.css" rel="stylesheet" />-->
<!--  <link href="/kendo-ui/content/mobile/examples.css" rel="stylesheet" />-->
  <link href="css/examples.css" rel="stylesheet" />
     
  <script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
  <script src="https://kendo.cdn.telerik.com/2020.1.114/js/kendo.all.min.js"></script>
  <script src="https://kendo.cdn.telerik.com/2020.1.114/js/kendo.timezones.min.js"></script>
  
  <link rel="stylesheet" href="css/loading.css" />
  <script src="js/loading.js"></script>  
    
</head>

<body id="examples">
  <!-- Google Tag Manager -->
  <!-- remarked by Paul Kang
    <noscript>
      <iframe src="https://www.googletagmanager.com/ns.html?id=GTM-6X92" height="0" width="0" style="display: none; visibility: hidden"></iframe>
    </noscript>
    <script>(function(w, d, s, l, i) { w[l] = w[l] || []; w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' }); var f = d.getElementsByTagName(s)[0], j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f); })(window, document, 'script', 'dataLayer', 'GTM-6X92');</script>
  -->
  <!-- End Google Tag Manager -->

  <!-- 
    若設  data-use-native-scrolling="true"，則 非 mobile mode 可以捲動，但 mobile mode 顯示有問題。
    若沒設 data-use-native-scrolling="true"，則 非 mobile mode 無法捲動，但 mobile mode 正常可捲動。
    -->

  <style scoped>
    .km-on-ios .km-header .km-navbar

    /* for data-title="北大林口中心團課" */
      {
      background-color: coralbl;
      /* deeppink; */
      font-size: 18px;
    }

    .km-on-ios .km-header .km-widget,
    .km-on-ios .km-header .km-view-title {
      color: white;
    }

    .報名課程title {
      font-size: 18px;
      font-weight: bold;
      margin-left: 15px;

    }

    .課程名稱 {
      font-size: 18px;
      margin-left: 15px;

    }
    
    #calendar,
    #calendar .k-calendar-view,
    #calendar .k-content {
        width: 100%;
    }    
  </style>

  <div data-role="view" data-title="北大林口運動中心團課" style="font-family: 'Noto Sans TC'" id="index" data-layout="" data-show="nullCurrentExample" data-init="initSearch">
    <header data-role="header">
      <div data-role="navbar" id="normal" class="km-accent">
        <!--                <a data-align="left" data-role="button" href="#about" data-rel="drawer" data-icon="drawer-icon"></a>-->
        <span data-role="view-title"></span>
        <span class="km-view-subtitle"></span>
        <a data-align="right" data-role="button" data-click="showSearch" data-click-on="down" data-icon="search"></a>
      </div>
      <div data-role="navbar" id="search" class="navbar-hidden">
        <div data-align="right" id="demos-search-container" data-align="right">
          <input type="search" id="demos-search" />
        </div>
      </div>
    </header>

    <div style="height: 15px"></div>

    <span class="報名課程title">報名課程</span>
    <a class="reply km-primary km-button-right" href="#actionsheet/團課日程.html" style="color: white; margin-right: 10px; " data-role="button" onclick="">查看日曆</a>

    <div style="height: 20px"></div>

    <hr>

    <div style="height: 15px"></div>
    <span class="報名課程title">已報名課程</span>
    <div style="height: 15px"></div>

    <ul data-role="listview" data-source="navDataSource" data-pull-to-refresh="true" data-template="nav-template" data-header-template="header-template" class="main-menu">

      <script type="text/x-kendo-template" id="header-template">
        <span class="km-icon km-#: value #"></span> #: value #
        </script>

      <script type="text/x-kendo-template" id="nav-template">
        <a href="#: url #" class="課程名稱">#: 課程名稱 # <br>
          <span style="font-size:16px; color: gray">#: 老師姓名 # </span>
          <span style="font-size:16px; color: gray; float:right; margin-right:20px" >#: 課程時間 #</span>
        </a>
      </script>

    </ul>

  </div>

  <div data-id="examples" data-role="layout" data-show="showDemoLayout" data-hide="removeView">
    <header data-role="header">
      <div data-role="navbar" class="km-accent">
        <a data-align="left" data-icon="arrow-w" href="#/" data-role="backbutton" data-transition="slide reverse"></a>
        <span data-role="view-title"></span>
        <!--        <a data-align="right" id="source-code-button" data-icon="source-code" data-click="goToSourceCode" data-role="button" title="Show this demo source code">Source Code</a>-->
      </div>
    </header>
  </div>

<!--  <script src="js/example-datasources.js"></script>-->
  <script src="js/data-process.js"></script>
  <script src="js/prettify.js"></script> 
  
  <script>
    var paramToSend = "";
    var inputParamString = location.search;
    var inputParam = inputParamString.split("&");
    var displayName, userId, pictureUrl;
    var inputError = false;
    var useLocalAPIs = false;
    
    //var memberData = [];
    //var dataToAdd = [];    
    var courseData=[];
    var courseHistory=[];
    var courseMember=[];    
    var userPhoneNumber;
    var allDataReady=0;

    notInCourse=[];
    inCourse=[];
    myHistory=[];      
    
    checkInputParam();
    checkUserIdExist();

    function checkInputParam() {
      console.log(inputParam);
      try {
        displayName = inputParam[0].split("=");
        userId = inputParam[1].split("=");
        pictureUrl = inputParam[2].split("=");
      } catch (e) {
        alert("輸入參數錯誤");
        $("#joinForm").hide();
        $("#errorMessage").css("display", "block");
        inputError = true;
      }

      console.log(displayName[1]);
      
      if (!inputError) {
        console.log(displayName, userId, pictureUrl);

        if (userId[0] == "userId") // && userId[1].length==33 ) {
          console.log("valid UserId ", userId[1]);
        //checkUserIdExist();
        $("#name").text(decodeURI(displayName[1]));
      } else {
        $("#joinForm").hide();
        $("#errorMessage").css("display", "block");
        alert("無效的 LINE ID!!");
      }
    }
    
    // ?displayName=小華&userId=U722be0c9c9d36e011c0e556bd2047819&pictureUrl=www.google.com
    function checkUserIdExist() {
      //Call API:00 檢查 userId 有沒有重複參加 */

      paramToSend = "?API=00" + "&UserId=" + userId[1];

      var request = new XMLHttpRequest();
      if (useLocalAPIs) {
        request.open('GET', 'http://localhost:5000' + paramToSend, true);
      } else {
        request.open('GET', 'https://api-linko-sports-center.herokuapp.com/'+paramToSend, true);
      }

      request.onload = function() {
        //$.loading.end();
        console.log(this.response);
        if (this.response == "API:00 會員不存在") {
          alert("為了讓您更容易使用團體課程，挑戰賽及使用優惠券，請填寫必要資料");
        } else {
          console.log("前往團課");
          //readCourses();
        }
      }
      // Send API request 
      //$.loading.start('檢查是否已填寫必要資料');
     
      request.send();
    }    
        
  </script>
</body>

</html>