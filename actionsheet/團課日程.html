<!DOCTYPE html>
<html>
<head>
  <style>html { font-size: 14px; font-family: Arial, Helvetica, sans-serif; }</style>
  <title></title>
  <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2020.1.114/styles/kendo.common.min.css" />
  <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2020.1.114/styles/kendo.default.min.css" />
  <link rel="stylesheet" href="https://kendo.cdn.telerik.com/2020.1.114/styles/kendo.mobile.all.min.css" />

  <script src="https://kendo.cdn.telerik.com/2020.1.114/js/jquery.min.js"></script>
  <script src="https://kendo.cdn.telerik.com/2020.1.114/js/kendo.all.min.js"></script>

</head>
<body>
  <div data-role="view" data-init="initData" data-title="團課日程" style="text-align: center;font-family: 'Noto Sans TC'">
     <div id="團課日程Div">
        <div id="calendar"></div>

        <div>
          <hr>
          <ul id="courseTable"></ul>        
        </div> 
     </div>
     <div id="報名表格" style="display: none" > 報名表格 </div>
  </div>
    
  <script type="text/x-kendo-template" id="course-template">
      <a class="reply km-primary km-button-right"
      style="color: white" 
      data-role="button"
      onclick="報名課程('#: 課程編號 #')" 
      id = "報名按鈕"
      >報名</a>
      <div style="text-align:left">#: 課程編號 # : #: 課程名稱 # <br>
        <span>#: 老師姓名 #</span> <span style="float:right; margin-right: 10px" >#: 上課時間 #</span>
      </div>
  </script>

  <script>
    function 報名課程(courseId){
      //使用 dialog, 參考 https://demos.telerik.com/kendo-ui/dialog/events

      console.log("報名課程", courseId);

    }  

    var dataSource;
    data = [];

      function initDataSource(){
          dataSource = new kendo.data.DataSource({    
              data: [],
              schema: {
                  total: function () { 
                    return 77; }
              },            
              serverPaging: true,
              pageSize: 40
          });      
      }

      function emptyDataSource(){
        var numToDel = dataSource.lastRange().end;
        for (var i=0; i< numToDel; i++){
          var toDel = dataSource.at(0);
          dataSource.remove(toDel);
        }
      }

      function convertDate(dateStr){
        var dateArr = dateStr.split("/");
  //      if (dateArr[0].length ==1) dateArr[0]= "0"+dateArr[0];
  //      if (dateArr[1].length ==1) dateArr[1]= "0"+dateArr[1];      
        return dateArr[2]+"-"+dateArr[0]+"-"+dateArr[1];
      }

      function onChange() {
        var selectedDateStr = kendo.toString(this.value(), 'd');
        var selectedDate = convertDate(selectedDateStr);
        console.log("Change :" + selectedDate);
        emptyDataSource();

        courseData.forEach(function(course, index, array){
          var courseDateArr = course[3].split(" ");
          var courseDate = courseDateArr[0];

          if (courseDate == selectedDate) {
            //console.log("matched ", course);
            dataSource.add({  
              "課程編號": course[0],
              "課程名稱": course[1],
              "老師姓名": course[2],
              "助教姓名": course[9],          
              "上課時間": course[3],  
              "燃燒熱量": course[4],
              "課程人數": course[6],
              "課程費用": course[5],
              "其他說明": course[10],
              "報名人數": course[7],
              "繳費人數": course[8],        
              "url": "actionsheet/course報名.html?courseId=" + "U0003",                  
              "ProductName": "一起來運動",
              //"UnitPrice": 100
            });          
          }

        });       
      }



      function onNavigate() {
          console.log("Navigate");
      }

      function initData(e) {
        console.log("init");

        initDataSource();

        $("#courseTable").kendoMobileListView({
            dataSource: dataSource,
            pullToRefresh: false,            
            template: $("#course-template").text()            
        });

        $("#calendar").kendoCalendar({
            change: onChange,
            navigate: onNavigate
        });
      }

  </script>


  <script>
      //var app = new kendo.mobile.Application(document.body, { skin: "nova" });
  </script>
</body>
</html>